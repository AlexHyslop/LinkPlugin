(()=>{"use strict";var e,t={251:(e,t,n)=>{const l=window.wp.blocks,s=window.wp.i18n,a=window.React,i=window.wp.element,r=window.wp.blockEditor,o=window.wp.components,c=window.wp.apiFetch;var d=n.n(c);const h=window.wp.compose,p=({posts:e,onSelectPost:t,loading:n,isSearchResults:l})=>n?(0,a.createElement)(o.Spinner,null):e.length?(0,a.createElement)("div",{className:"stylized-anchor-link-results"},(0,a.createElement)("h3",{className:"stylized-anchor-link-results-title"},l?(0,s.__)("Search results","stylized-anchor-link"):(0,s.__)("Recent posts","stylized-anchor-link")),e.map(e=>(0,a.createElement)(o.Button,{key:e.id,isSecondary:!0,onClick:()=>t(e),className:"stylized-anchor-link-result-item"},e.title.rendered," ",(0,a.createElement)("span",{className:"post-id"},"#",e.id)))):(0,a.createElement)("p",null,l?(0,s.__)("No posts found.","stylized-anchor-link"):(0,s.__)("No recent posts found.","stylized-anchor-link")),y=({currentPage:e,totalPages:t,onPageChange:n})=>t<=1?null:(0,a.createElement)("div",{className:"stylized-anchor-link-pagination"},(0,a.createElement)(o.Button,{isSecondary:!0,disabled:e<=1,onClick:()=>n(e-1)},(0,s.__)("Previous","stylized-anchor-link")),(0,a.createElement)("span",{className:"stylized-anchor-link-pagination-info"},e," / ",t),(0,a.createElement)(o.Button,{isSecondary:!0,disabled:e>=t,onClick:()=>n(e+1)},(0,s.__)("Next","stylized-anchor-link")));(0,l.registerBlockType)("stylized-anchor-link/post-link",{title:(0,s.__)("Stylized Anchor Link","stylized-anchor-link"),description:(0,s.__)("Insert a stylized link to another post.","stylized-anchor-link"),category:"widgets",icon:"admin-links",keywords:[(0,s.__)("link","stylized-anchor-link"),(0,s.__)("post","stylized-anchor-link"),(0,s.__)("anchor","stylized-anchor-link")],attributes:{postId:{type:"number",default:0},postTitle:{type:"string",default:""},postUrl:{type:"string",default:""}},edit:function({attributes:e,setAttributes:t}){const{postId:n,postTitle:l,postUrl:c}=e,[m,u]=(0,i.useState)(""),[k,_]=(0,i.useState)([]),[f,z]=(0,i.useState)([]),[w,g]=(0,i.useState)(!1),[E,v]=(0,i.useState)(""),[b,S]=(0,i.useState)(1),[N,P]=(0,i.useState)(1),[C,I]=(0,i.useState)(!1),O=(0,r.useBlockProps)({className:"dmg-read-more"});(0,i.useEffect)(()=>{!n||l&&c||A(n)},[n,l,c]),(0,i.useEffect)(()=>{B()},[]),(0,i.useEffect)(()=>{m.trim()&&C&&x()},[b,C]),(0,i.useEffect)(()=>{const e=m.trim();e.length>=2?(I(!0),T()):0===e.length&&C&&I(!1)},[m]);const T=(0,h.debounce)(()=>{m.trim().length>=2&&(S(1),x())},500),B=async()=>{g(!0),v("");try{const e=await d()({path:"/wp/v2/posts?per_page=5&orderby=date&order=desc&_fields=id,title,link"});z(Array.isArray(e)?e:[])}catch(e){console.error("Failed to fetch recent posts:",e),v((0,s.__)("Failed to fetch recent posts.","stylized-anchor-link"))}finally{g(!1)}},x=async()=>{if(m.trim()){if(g(!0),v(""),/^\d+$/.test(m.trim())&&1===b)try{const e=await d()({path:`/wp/v2/posts/${m.trim()}?_fields=id,title,link`});return _([e]),P(1),void g(!1)}catch(e){console.error("Post not found by ID:",e)}try{const e=await d()({path:`/wp/v2/posts?search=${encodeURIComponent(m)}&page=${b}&per_page=5&_fields=id,title,link`,parse:!1}),t=await e.json(),n=e.headers.get("X-WP-TotalPages");P(n?parseInt(n,10):Math.ceil(t.length/5)||1),_(Array.isArray(t)?t:[])}catch(e){console.error("Failed to search posts:",e),v((0,s.__)("Failed to search posts.","stylized-anchor-link")),_([])}finally{g(!1)}}},A=async e=>{if(e){g(!0),v("");try{const n=await d()({path:`/wp/v2/posts/${e}?_fields=id,title,link`});t({postId:n.id,postTitle:n.title.rendered,postUrl:n.link})}catch(e){console.error("Post not found with that ID:",e),v((0,s.__)("Post not found with that ID.","stylized-anchor-link"))}finally{g(!1)}}},R=C?k:f;return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(r.InspectorControls,null,(0,a.createElement)(o.PanelBody,{title:(0,s.__)("Post Selection","stylized-anchor-link")},(0,a.createElement)("div",{className:"stylized-anchor-link-search-container"},(0,a.createElement)("div",{className:"stylized-anchor-link-search-input-wrapper"},(0,a.createElement)(o.TextControl,{label:(0,s.__)("Search Posts","stylized-anchor-link"),value:m,onChange:u,placeholder:(0,s.__)("Enter post title or ID...","stylized-anchor-link"),help:(0,s.__)("Type at least 2 characters to search","stylized-anchor-link")}),m&&(0,a.createElement)(o.Button,{className:"stylized-anchor-link-clear-search",icon:"dismiss",onClick:()=>{u(""),_([]),v(""),S(1),P(1),I(!1),0===f.length&&B()},label:(0,s.__)("Clear search","stylized-anchor-link")}))),E&&(0,a.createElement)(o.Notice,{status:"error",isDismissible:!1},E),(0,a.createElement)(p,{posts:R,onSelectPost:e=>{t({postId:e.id,postTitle:e.title.rendered,postUrl:e.link})},loading:w,isSearchResults:C}),C&&(0,a.createElement)(y,{currentPage:b,totalPages:N,onPageChange:e=>{S(e)}}),n&&l&&(0,a.createElement)("div",{className:"stylized-anchor-link-selected-post"},(0,a.createElement)("h3",{className:"stylized-anchor-link-selected-title"},(0,s.__)("Currently selected","stylized-anchor-link")),(0,a.createElement)("div",{className:"stylized-anchor-link-selected-item"},(0,a.createElement)("span",{className:"stylized-anchor-link-selected-text"},l," ",(0,a.createElement)("span",{className:"post-id"},"#",n)),(0,a.createElement)(o.Button,{className:"stylized-anchor-link-remove-selection",icon:"dismiss",onClick:()=>{t({postId:null,postTitle:"",postUrl:""})},label:(0,s.__)("Remove selection","stylized-anchor-link")}))))),(0,a.createElement)("div",{...O},n&&l?(0,a.createElement)("p",{className:"dmg-read-more"},(0,s.__)("Read More: ","stylized-anchor-link"),(0,a.createElement)("a",{href:c},l)):(0,a.createElement)(o.Placeholder,{icon:"admin-links",label:(0,s.__)("Stylized Anchor Link","stylized-anchor-link"),instructions:(0,s.__)("Search for a post in the sidebar to create a stylized link.","stylized-anchor-link")})))},save:()=>null})}},n={};function l(e){var s=n[e];if(void 0!==s)return s.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,l),a.exports}l.m=t,e=[],l.O=(t,n,s,a)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,s,a]=e[d],r=!0,o=0;o<n.length;o++)(!1&a||i>=a)&&Object.keys(l.O).every(e=>l.O[e](n[o]))?n.splice(o--,1):(r=!1,a<i&&(i=a));if(r){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,s,a]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};l.O.j=t=>0===e[t];var t=(t,n)=>{var s,a,[i,r,o]=n,c=0;if(i.some(t=>0!==e[t])){for(s in r)l.o(r,s)&&(l.m[s]=r[s]);if(o)var d=o(l)}for(t&&t(n);c<i.length;c++)a=i[c],l.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return l.O(d)},n=globalThis.webpackChunkstylized_anchor_link=globalThis.webpackChunkstylized_anchor_link||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=l.O(void 0,[350],()=>l(251));s=l.O(s)})();